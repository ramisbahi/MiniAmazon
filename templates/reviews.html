{% extends 'layout.html' %}
{% block heading %}{% endblock %}
{% block content %}
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-primary alert-dismissible fade show" role="alert">
                    <span>{{ message }}</span>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <h2>All Reviews for {{item.item_name}}</h2>

    <ul>
        {% for review in reviews %}
            <li>{{review.item_rating}} stars</li>
            <li>Comment: {{review.comments}}</li>
            <li>By: {{review.buyer_username}}</li>
            <br />
        {% endfor %}
    </ul>
    <hr/>
    <p>{{reviews|length}} review{{reviews|length|pluralize}}
        found in the database for an average rating of {{avg_rating}}.</p>

    <h4>Add rating: </h4>
    <form action="{{url_for('review', product_id=item.product_id)}}" method="POST">
        {{form.csrf_token}}
        <p>
            Rating: {{form.item_rating}}
            {% if form.item_rating.errors %}
                <ul>{% for error in form.item_rating.errors %}<li>{{error}}</li>{% endfor %}</ul>
            {% endif %}
        </p>
        <p>
            Comment: {{form.comments}}
            {% if form.comments.errors %}
                <ul>{% for error in form.comments.errors %}<li>{{error}}</li>{% endfor %}</ul>
            {% endif %}
        </p>
        <hr/>
        <input type="reset" value="Reset"/>
        <input type="submit" value="Submit"/>
        {% if 'database' in form.errors %}<p>{{form.errors['database']}}</p>{% endif %}
    </form>
    {% if 'database' in form.errors %}<p>{{form.errors['database']}}</p>{% endif %}

{% endblock %}
